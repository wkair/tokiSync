# ☁️ TokiSync (토끼싱크)

**북토끼, 뉴토끼, 마나토끼**의 콘텐츠를 **구글 드라이브로 직접 업로드**하고, **구글 스프레드시트에 다운로드 기록을 자동 동기화**하는 강력한 유저 스크립트입니다.

> **Original Idea by:** hehaho (tokiDownloader)  
> **Rewritten by:** pray4skylark

-----

## ✨ 주요 기능

  * **☁️ 구글 드라이브 직통 업로드:** PC 저장공간을 거치지 않고, 메모리에서 바로 구글 드라이브로 전송합니다. (NAS처럼 활용 가능)
  * **📂 자동 분류:** `[작품번호] 제목` 폴더를 자동으로 생성하고, 그 안에 `0001 - 1화.cbz` 형식으로 깔끔하게 정리합니다.
  * **🔄 스마트 동기화:** 버튼 하나로 \*\*"아직 받지 않은 회차"\*\*만 자동으로 골라내어 다운로드합니다.
  * **🚀 파이프라이닝 가속:** 1화가 업로드되는 동안 2화를 미리 다운로드하여 대기 시간을 최소화합니다.
  * **📦 대용량 이어 올리기:** 구글 드라이브 API의 청크 업로드(Resumable Upload)를 구현하여 용량 제한 없이 업로드 가능합니다.
  * **🛡️ 강력한 차단 회피:**
      * **백그라운드 스로틀링 방지:** 탭을 내려놔도 속도가 느려지지 않도록 오디오 트릭(Oscillator)을 사용합니다.
      * **자동 재시도:** 네트워크 오류나 구글 429(Too Many Requests) 오류 발생 시 지능적으로 재시도합니다.
      * **캡차 감지:** 진행 중 캡차가 뜨면 일시 정지하고 사용자에게 알림을 보냅니다.

-----

## ⚙️ 설치 가이드 (Installation)

이 스크립트는 \*\*서버(Google Apps Script)\*\*와 **클라이언트(Tampermonkey)** 두 가지 설정이 필요합니다.

### 1️⃣ 1단계: 구글 서버(Backend) 설정

서버 코드는 이 저장소의 **`/google_app_script/`** 폴더에 위치해 있습니다.

1.  [구글 스프레드시트](https://sheets.google.com)에 접속하여 **새 스프레드시트**를 생성합니다. (이름 예: `TokiDB`)
2.  상단 메뉴에서 **`확장 프로그램`** \> \*\*`Apps Script`\*\*를 클릭합니다.
3.  **권한 설정 파일 (`appsscript.json`) 적용:**
      * 좌측 메뉴의 **`설정(⚙️)`** \> \*\*`"appsscript.json" 매니페스트 파일 표시`\*\*를 체크합니다.
      * 좌측 파일 목록에 나타난 `appsscript.json`을 클릭합니다.
      * **`/google_app_script/appsscript.json`** 파일의 내용을 복사하여 덮어씁니다.
4.  **서버 코드 (`Code.gs`) 적용:**
      * 좌측 파일 목록에서 `Code.gs`를 클릭합니다.
      * **`/google_app_script/Code.gs`** 파일의 내용을 복사하여 덮어씁니다.
5.  **변수 수정 (필수):**
      * 붙여넣은 `Code.gs` 상단의 설정을 본인 환경에 맞게 수정합니다.
    <!-- end list -->
    ```javascript
    const ROOT_FOLDER_ID = "여기에_구글드라이브_폴더_ID"; 
    const SECRET_KEY = "원하는_비밀번호_입력"; 
    ```
6.  **최초 권한 승인:**
      * 코드 맨 아래의 `authorizeCheck` 함수를 선택하고 \*\*실행(▷)\*\*을 누릅니다.
      * 구글 권한 요청 팝업이 뜨면 **[권한 검토]** -\> 계정 선택 -\> **[고급]** -\> **[...로 이동(안전하지 않음)]** -\> \*\*[허용]\*\*을 진행합니다.
7.  **배포 (Deployment):**
      * 우측 상단 **`배포`** \> **`새 배포`** 클릭.
      * 유형: **웹 앱**.
      * 설명: `TokiSync v1`.
      * 다음 사용자 계정으로 실행: **나 (Me)**.
      * 액세스 권한 승인: **🚨 모든 사용자 (Anyone) 🚨** (필수\!)
      * **`배포`** 버튼 클릭 후 생성된 **웹 앱 URL**을 복사해 둡니다.

-----

### 2️⃣ 2단계: 클라이언트(Frontend) 설정

1.  크롬/웨일/엣지 브라우저에 \*\*[Tampermonkey 확장 프로그램](https://www.tampermonkey.net/)\*\*을 설치합니다.
2.  Tampermonkey 아이콘 클릭 \> **`새 스크립트 만들기`** 클릭.
3.  **`TokiSync.user.js`** 파일의 전체 코드를 복사하여 붙여넣습니다.
4.  **`파일`** \> \*\*`저장`\*\*을 누릅니다.

-----

### 3️⃣ 3단계: 연동 (Configuration)

1.  웹툰 사이트(뉴토끼 등)의 **목록 페이지**로 접속합니다.
2.  Tampermonkey 메뉴를 열고 \*\*`⚙️ 설정 (URL/Key 입력)`\*\*을 클릭합니다.
3.  **1단계**에서 복사한 **Apps Script URL**과 설정한 \*\*비밀번호(Key)\*\*를 차례로 입력합니다.
4.  `✅ 설정 저장 완료` 메시지가 뜨면 준비 끝\!

-----

## 📖 사용 방법 (Usage)

### ☁️ 자동 동기화 (추천)

  * **기능:** 현재 페이지의 목록과 구글 시트의 기록을 비교하여, **없는 회차만** 다운로드합니다.
  * **사용법:** 메뉴에서 `☁️ 자동 동기화` 클릭.

### 🔢 범위 다운로드

  * **기능:** 지정한 범위(예: 1화 \~ 10화)를 강제로 다운로드합니다. (이미 있어도 덮어씀)
  * **사용법:** 메뉴에서 `🔢 범위 다운로드` 클릭 -\> 시작 번호/끝 번호 입력.

### 👆 1회성 다운로드

  * **기능:** 특정 화 하나만 다운로드합니다.

-----

## 🚦 상태 표시줄 (Status UI)

화면 우측 하단에 현재 작업 상태가 표시됩니다.

  * `⏳ 로딩 중`: 페이지 접속 중. (리스트 노란색)
  * `🖼️ 이미지 수집 중`: 이미지 다운로드 중.
  * `📦 압축 중`: ZIP/CBZ 파일 생성 중. (리스트 주황색)
  * `🚀 업로드 시작`: 구글 드라이브로 전송 시작. (리스트 파란색)
  * `✅ 완료`: 업로드 및 기록 저장 완료. (리스트 회색)

-----

## ⚠️ 주의사항 및 문제 해결

1.  **오류: Network Error / 429 Error**
      * 구글 서버가 일시적으로 바쁠 때 발생합니다. 스크립트가 자동으로 5회까지 재시도하니 기다려주세요.
2.  **캡차(Captcha) 발생**
      * 스크립트가 일시 정지되고 화면 중앙에 인증 창이 뜹니다.
      * 직접 캡차를 풀고 **[캡차 해결 완료]** 버튼을 누르면 이어서 진행됩니다.
3.  **브라우저 탭 유지**
      * '오디오 트릭' 덕분에 창을 내려도 되지만, **탭을 아예 닫거나 브라우저를 종료하면** 작업이 중단됩니다.

-----

## 📜 License

This project is a modified version based on 'tokiDownloader'.
Use responsibly. [MIT License](https://www.google.com/search?q=LICENSE).
